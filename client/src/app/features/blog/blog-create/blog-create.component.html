<section class="bg-white py-12 sm:py-16">
  <div class="mx-auto max-w-3xl py-12 px-4 sm:px-6 lg:px-8">
    <div class="mb-10 text-center">
      <h1 class="text-3xl font-semibold tracking-tight text-gray-900 sm:text-4xl">
        Create a New Article
      </h1>
      <p class="mt-3 text-lg text-gray-500">
        Share your thoughts, ideas, or announcements with your audience.
      </p>
    </div>

    <form class="space-y-8" [formGroup]="postForm" (ngSubmit)="handleFormSubmit()">
      <!-- Post Title -->
      <div>
        <label for="postTitle" class="block text-sm font-medium text-gray-700">Title</label>
        <input type="text" name="postTitle" id="postTitle" placeholder="Enter post title"
          class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm py-3 px-4 bg-white text-gray-900 placeholder:text-gray-400 focus:ring-2 focus:ring-indigo-600 focus:border-indigo-600 focus:outline-none"
          formControlName="postTitle" [class.border-red-500]="
            postForm.get('postTitle')?.invalid &&
            postForm.get('postTitle')?.touched
          " />

        <!-- Title Error Messages -->

        <ng-container *ngIf="
            postForm.get('postTitle')?.invalid &&
            postForm.get('postTitle')?.touched
          ">
          <div class="mt-2 text-sm text-red-600">
            <div *ngIf="postForm.get('postTitle')?.errors?.['required']">
              Title is required
            </div>
            <div *ngIf="postForm.get('postTitle')?.errors?.['maxlength']">
              Title cannot exceed 150 characters
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Post Image -->
      <div>
        <label for="image" class="block text-sm font-medium text-gray-700">
          Featured Image
        </label>

        <!-- Upload Area -->
        <div class="mt-1 flex justify-center rounded-lg border border-dashed border-gray-300 px-6 py-10">
          <div class="text-center">
            <svg class="mx-auto h-12 w-12 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"
              aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>

            <div class="mt-4 flex text-sm text-gray-600">
              <label for="file-upload"
                class="relative cursor-pointer rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none">
                <span>Upload a file</span>
                <input 
                #fileInput
                (change)="onFileSelected($event)"
                id="file-upload" 
                name="file-upload" 
                type="file" class="sr-only"
                accept="image/*"/>
              </label>

              <ng-container *ngIf="isUploading">
                <div class="ml-2 flex items-center">
                  <div class="spinner-border spinner-border-sm" role="status"></div>
                  <span class="ml-1">Uploading to Google Drive...</span>
                </div>
              </ng-container>

              <p class="pl-1" *ngIf="!isUploading">or drag and drop</p>
            </div>

            <p class="text-xs text-gray-500">PNG, JPG, GIF up to 10MB</p>
          </div>
        </div>
        <!-- Preview with local file -->
        <ng-container *ngIf="previewUrl">
          <div class="mt-4 text-center">
            <p class="text-sm text-green-600 mb-2">Image selected:</p>
            <img [src]="previewUrl" alt="Preview" class="max-w-xs mx-auto rounded-lg shadow-md" />
            <div class="mt-2">
              <button 
              type="button"
              class="btn btn-sm btn-danger text-sm text-red-600 mb-2"
              (click)="onRemoveImage()" >
                Remove Image
              </button>
            </div>
          </div>
        </ng-container>


        <!-- Hidden input and stores the current url for the form -->
        <input type="hidden" formControlName="postImageUrl">
      </div>

      <!-- Category Dropdown -->
      <div>
        <label for="postCategory" class="block text-sm font-medium text-gray-700">Category</label>
        <select id="postCategory" name="postCategory"
          class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm py-3 px-4 bg-white text-gray-900 focus:ring-2 focus:ring-indigo-600 focus:border-indigo-600 focus:outline-none"
          formControlName="postCategory" [class.border-red-500]="
            postForm.get('postCategory')?.invalid &&
            postForm.get('postCategory')?.touched
          ">
          <option value="" disabled selected>Select a category</option>
          <option value="technology">Technology</option>
          <option value="languages">Languages</option>
          <option value="tools">Tools</option>
          <option value="topics">Topics</option>
        </select>

        <!-- Category Error Messages -->
        <ng-container *ngIf="
            postForm.get('postCategory')?.invalid &&
            postForm.get('postCategory')?.touched
          ">
          <div class="mt-2 text-sm text-red-600">
            <div *ngIf="postForm.get('postCategory')?.errors?.['required']">
              Please select a category
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Post Content -->
      <div>
        <label for="postText" class="block text-sm font-medium text-gray-700">Content</label>
        <div class="mt-1">
          <textarea id="postText" name="postText" rows="10" placeholder="Write your post content here..."
            class="block w-full rounded-md border border-gray-300 shadow-sm py-3 px-4 bg-white text-gray-900 placeholder:text-gray-400 focus:ring-2 focus:ring-indigo-600 focus:border-indigo-600 focus:outline-none"
            formControlName="postText" [class.border-red-500]="
              postForm.get('postText')?.invalid &&
              postForm.get('postText')?.touched
            "></textarea>
        </div>
        <p class="mt-2 text-sm text-gray-500">
          Use markdown for formatting. You can use **bold**, *italic*,
          [links](http://example.com), and more.
        </p>

        <!-- Content Error Messages -->
        <ng-container *ngIf="
            postForm.get('postText')?.invalid &&
            postForm.get('postText')?.touched
          ">
          <div class="mt-2 text-sm text-red-600">
            <div *ngIf="postForm.get('postText')?.errors?.['required']">
              Content is required
            </div>
            <div *ngIf="postForm.get('postText')?.errors?.['maxlength']">
              Content cannot exceed 3000 characters
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Tags -->
      <div>
        <label for="postTags" class="block text-sm font-medium text-gray-700">Tags</label>
        <input type="text" name="postTags" id="postTags" placeholder="Enter tags separated by commas"
          class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm py-3 px-4 bg-white text-gray-900 placeholder:text-gray-400 focus:ring-2 focus:ring-indigo-600 focus:border-indigo-600 focus:outline-none"
          formControlName="postTags" [class.border-red-500]="
            postForm.get('postTags')?.invalid &&
            postForm.get('postTags')?.touched
          " />
        <p class="mt-2 text-sm text-gray-500">
          Tags help readers discover your content. Add up to 3 tags.
        </p>

        <!-- Tags Error Messages -->
        <ng-container *ngIf="
            postForm.get('postTags')?.invalid &&
            postForm.get('postTags')?.touched
          ">
          <div class="mt-2 text-sm text-red-600">
            <div *ngIf="postForm.get('postTags')?.errors?.['required']">
              Please add at least one tag
            </div>
          </div>
        </ng-container>
      </div>

      <!-- todo: Publishing Options -->
      <div>
        <h3 class="text-lg font-medium text-gray-900">Publishing Options</h3>
        <div class="mt-4 space-y-4">
          <div class="flex items-start">
            <div class="flex h-5 items-center">
              <input id="draft" name="status" type="radio" value="draft" checked
                class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-600" />
            </div>
            <div class="ml-3 text-sm">
              <label for="draft" class="font-medium text-gray-700">Save as Draft</label>
              <p class="text-gray-500">
                Save your post but don't publish it yet.
              </p>
            </div>
          </div>
          <div class="flex items-start">
            <div class="flex h-5 items-center">
              <input id="publish" name="status" type="radio" value="publish"
                class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-600" />
            </div>
            <div class="ml-3 text-sm">
              <label for="publish" class="font-medium text-gray-700">Publish Now</label>
              <p class="text-gray-500">
                Your post will be published immediately.
              </p>
            </div>
          </div>
          <div class="flex items-start">
            <div class="flex h-5 items-center">
              <input id="schedule" name="status" type="radio" value="schedule"
                class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-600" />
            </div>
            <div class="ml-3 text-sm">
              <label for="schedule" class="font-medium text-gray-700">Schedule</label>
              <p class="text-gray-500">Choose a date and time to publish.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="pt-5 mt-8 flex justify-end gap-4 border-t border-gray-200">
        <button type="button"
          class="rounded-md border border-gray-300 bg-white py-2.5 px-5 text-sm font-semibold text-gray-900 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-600 focus:ring-offset-2"
          (click)="onCancel()">
          Cancel
        </button>
        <button type="submit" [disabled]="postForm.invalid"
          class="rounded-md bg-indigo-600 py-2.5 px-5 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-600 focus:ring-offset-2">
          Save Post
        </button>
      </div>
    </form>

    <div *ngIf="errResponseMsg" class="error-message text-red-600 font-medium mt-2">
      {{ errResponseMsg.message }}
    </div>
  </div>
</section>