<section class="bg-white py-12 sm:py-16">
  <div class="mx-auto max-w-3xl py-12 px-4 sm:px-6 lg:px-8">
    <div class="mb-10 text-center">
      <h1 class="text-3xl font-semibold tracking-tight text-gray-900 sm:text-4xl">
        Edit Article
      </h1>
      <p class="mt-3 text-lg text-gray-500">
        Update your post content and settings.
      </p>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="text-center py-8">
      <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
      <p class="mt-2 text-sm text-gray-500">Loading article...</p>
    </div>

    <!-- Edit Form -->
    <form *ngIf="!loading" class="space-y-8" [formGroup]="editPostForm" (ngSubmit)="handleEditFormSubmit()">
      <!-- Post Title -->
      <div>
        <label for="postTitle" class="block text-sm font-medium text-gray-700">Title</label>
        <input type="text" name="postTitle" id="postTitle" placeholder="Enter post title"
          class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm py-3 px-4 bg-white text-gray-900 placeholder:text-gray-400 focus:ring-2 focus:ring-indigo-600 focus:border-indigo-600 focus:outline-none"
          formControlName="postTitle" [class.border-red-500]="
            editPostForm.get('postTitle')?.invalid &&
            editPostForm.get('postTitle')?.touched
          " />

        <!-- Title Error Messages -->
        <ng-container *ngIf="
            editPostForm.get('postTitle')?.invalid &&
            editPostForm.get('postTitle')?.touched
          ">
          <div class="mt-2 text-sm text-red-600">
            <div *ngIf="editPostForm.get('postTitle')?.errors?.['required']">
              Title is required
            </div>
            <div *ngIf="editPostForm.get('postTitle')?.errors?.['maxlength']">
              Title cannot exceed 150 characters
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Post Image -->
      <div>
        <label for="postImageUrl" class="block text-sm font-medium text-gray-700">Image URL</label>
        <input type="url" name="postImageUrl" id="postImageUrl" placeholder="Enter image URL"
          class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm py-3 px-4 bg-white text-gray-900 placeholder:text-gray-400 focus:ring-2 focus:ring-indigo-600 focus:border-indigo-600 focus:outline-none"
          formControlName="postImageUrl" [class.border-red-500]="
            editPostForm.get('postImageUrl')?.invalid &&
            editPostForm.get('postImageUrl')?.touched
          " />

        <!-- Image Error Messages -->
        <ng-container *ngIf="
            editPostForm.get('postImageUrl')?.invalid &&
            editPostForm.get('postImageUrl')?.touched
          ">
          <div class="mt-2 text-sm text-red-600">
            <div *ngIf="editPostForm.get('postImageUrl')?.errors?.['required']">
              Image URL is required
            </div>
          </div>
        </ng-container>

        <!-- Image Preview -->
        <div *ngIf="editPostForm.get('postImageUrl')?.value" class="mt-3">
          <img [src]="editPostForm.get('postImageUrl')?.value" 
               alt="Post image preview" 
               class="h-48 w-full object-cover rounded-md border border-gray-300" />
        </div>
      </div>

      <!-- Category Dropdown -->
      <div>
        <label for="postCategory" class="block text-sm font-medium text-gray-700">Category</label>
        <select id="postCategory" name="postCategory"
          class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm py-3 px-4 bg-white text-gray-900 focus:ring-2 focus:ring-indigo-600 focus:border-indigo-600 focus:outline-none"
          formControlName="postCategory" [class.border-red-500]="
            editPostForm.get('postCategory')?.invalid &&
            editPostForm.get('postCategory')?.touched
          ">
          <option value="" disabled>Select a category</option>
          <option value="technologies">Technology</option>
          <option value="languages">Languages</option>
          <option value="tools">Tools</option>
          <option value="topics">Topics</option>
        </select>

        <!-- Category Error Messages -->
        <ng-container *ngIf="
            editPostForm.get('postCategory')?.invalid &&
            editPostForm.get('postCategory')?.touched
          ">
          <div class="mt-2 text-sm text-red-600">
            <div *ngIf="editPostForm.get('postCategory')?.errors?.['required']">
              Please select a category
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Post Content -->
      <div>
        <label for="postText" class="block text-sm font-medium text-gray-700">Content</label>
        <div class="mt-1">
          <textarea id="postText" name="postText" rows="10" placeholder="Write your post content here..."
            class="block w-full rounded-md border border-gray-300 shadow-sm py-3 px-4 bg-white text-gray-900 placeholder:text-gray-400 focus:ring-2 focus:ring-indigo-600 focus:border-indigo-600 focus:outline-none"
            formControlName="postText" [class.border-red-500]="
              editPostForm.get('postText')?.invalid &&
              editPostForm.get('postText')?.touched
            "></textarea>
        </div>
        <p class="mt-2 text-sm text-gray-500">
          Use markdown for formatting. You can use **bold**, *italic*,
          [links](http://example.com), and more.
        </p>

        <!-- Content Error Messages -->
        <ng-container *ngIf="
            editPostForm.get('postText')?.invalid &&
            editPostForm.get('postText')?.touched
          ">
          <div class="mt-2 text-sm text-red-600">
            <div *ngIf="editPostForm.get('postText')?.errors?.['required']">
              Content is required
            </div>
            <div *ngIf="editPostForm.get('postText')?.errors?.['maxlength']">
              Content cannot exceed 3000 characters
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Tags -->
      <div>
        <label for="postTags" class="block text-sm font-medium text-gray-700">Tags</label>
        <input type="text" name="postTags" id="postTags" placeholder="Enter tags separated by commas"
          class="mt-1 block w-full rounded-md border border-gray-300 shadow-sm py-3 px-4 bg-white text-gray-900 placeholder:text-gray-400 focus:ring-2 focus:ring-indigo-600 focus:border-indigo-600 focus:outline-none"
          formControlName="postTags" [class.border-red-500]="
            editPostForm.get('postTags')?.invalid &&
            editPostForm.get('postTags')?.touched
          " />
        <p class="mt-2 text-sm text-gray-500">
          Tags help readers discover your content. Add up to 3 tags.
        </p>

        <!-- Tags Error Messages -->
        <ng-container *ngIf="
            editPostForm.get('postTags')?.invalid &&
            editPostForm.get('postTags')?.touched
          ">
          <div class="mt-2 text-sm text-red-600">
            <div *ngIf="editPostForm.get('postTags')?.errors?.['required']">
              Please add at least one tag
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Action Buttons -->
       <div class="pt-5 mt-8 flex justify-end gap-4 border-t border-gray-200">
        <button type="button"
          class="rounded-md border border-gray-300 bg-white py-2.5 px-5 text-sm font-semibold text-gray-900 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-600 focus:ring-offset-2"
          (click)="onCancel()">
          Cancel
        </button>
        <button type="submit" [disabled]="editPostForm.invalid"
          [ngClass]="editPostForm.valid ? 'form-is-active' : 'form-is-not-active'"
          class="rounded-md py-2.5 px-5 text-sm font-semibold text-white shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2">
          Update Article
        </button>

      </div>
    </form>
    
    <app-error-notification></app-error-notification>
  </div>
</section>